\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{intersec}[2008/10/14 Intersec DocBook Style]

\DeclareOption*{\PassOptionsToPackage{\CurrentOption}{docbook}}
\ProcessOptions\relax

\usepackage[usenames,dvipsnames]{color}
\usepackage{docbook}

\usepackage{bookmark}
\bookmarksetup{
  numbered,
}

% 2cm left, 17cm text, 2cm right -> 21cm
\setlength{\oddsidemargin}{2cm}
\setlength{\textwidth}{17cm}
\setlength{\headwidth}{\textwidth}

\setlength{\topmargin}{1cm}
\setlength{\headsep}{2cm}
\setlength{\textheight}{24cm}
% indent itemized lists.
\setitemize{leftmargin=1cm}
\setlist{topsep=0pt}
\setlist{partopsep=0pt}
\setlist{parsep=0pt}
%\setlist{itemsep=0pt}

\definecolor{is_red}{rgb}{0.8,0.05,0.1}

\usepackage{soul}
\sodef\csspace{}{.3em}{1em}{0pt}
\titleformat*{\section}{\LARGE\sf\bfseries\color{is_red}}
\titleformat*{\subsection}{\Large\sf\bfseries\color{is_red}}
\titleformat*{\subsubsection}{\large\sf\bfseries\color{is_red}}

\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage[scaled=0.85]{DejaVuSansMono}

% en-tete et pied de page
\renewcommand{\footrulewidth}{1pt}
\renewcommand{\plainheadrulewidth}{0pt}
\renewcommand{\plainfootrulewidth}{1pt}

\let\oldheadrule=\headrule
\renewcommand{\headrule}{\textcolor{is_red}{\oldheadrule}}
\let\oldfootrule=\footrule
\renewcommand{\footrule}{\textcolor{is_red}{\oldfootrule}}

\renewcommand{\sectionmark}[1]{\markboth{\MakeUppercase{\thesection\ #1}}{}}

\def\PageHeader{
  \colorbox{is_red}{\parbox{1cm}{\centerline{
    \color{white}\textbf{\thepage}
  }}}
}

\def\DBKrheadbody{
  \textsf{
    \textcolor{is_red}{\leftmark}
    \hspace{2cm}
    \PageHeader
  }
}

\def\ISHeader{
  \lhead[]{
    \hspace{-1.5cm}
    \centerline{\includegraphics[width=\paperwidth]{IS-title.png}}
    \\
    \vspace{-15.5cm}
    \includegraphics[height=1.5cm]{IS-logo.pdf}
    \vspace{-0.25cm}
  }
  \chead[]{}
  \rhead[]{\fancyplain{\PageHeader}{\DBKrheadbody}}
}

\def\ISFooter{
  \lfoot[]{}
  \cfoot[]{\copyright Intersec - Intersec is a trademark of the Intersec Group}
  \rfoot[]{}
}

\def\frontmatter{
  \cleardoublepage\pagenumbering{roman}
  \ISFooter\ISHeader
}

\def\mainmatter{
  \cleardoublepage\pagenumbering{arabic}
  \ISFooter\ISHeader
}

\def\DBKcover{
  \thispagestyle{plain}
  \ifthenelse{\equal{\DBKedition}{}}{\def\edhead{}}{\def\edhead{Ed. \DBKedition}}

  \setlength{\oldbaselineskip}{\baselineskip}
  \setlength{\baselineskip}{2\oldbaselineskip}

  \lhead[]{
    \hspace{-1.5cm}
    \centerline{\includegraphics[width=\paperwidth]{IS-title.png}}
    \\
    \vspace{-15cm}
    \includegraphics[height=3cm]{IS-logo.pdf}
  }
  \chead[]{}
  \rhead[]{}

  \textsf{
    \vfill
      \vspace{2.5cm}
    \begin{center}
    \Huge{\color{is_red}\textbf{\DBKtitle}}\\ %
      \ifthenelse{\equal{\DBKsubtitle}{}}{}{
        \underline{\ \ \ \ \ \ \ \ \ \ \ }\\ %
          \ \\ %
          \LARGE{\textbf{\DBKsubtitle}}\\ %
      }
    \end{center}
    \vfill
      \setlength{\baselineskip}{\oldbaselineskip}
    \hspace{1cm}
    \vspace{1cm}
    \begin{center}
    \begin{tabular}{p{7cm} p{7cm}}
    \Large{\DBKreference{} \edhead} & \\
      \end{tabular}
    \end{center}
  }

  \newpage
  \setlength{\baselineskip}{\oldbaselineskip}
  \frontmatter
}

\renewenvironment{DBKlegalnotice}{
    \textsf{\LARGE{\textbf{\color{is_red}\DBKlegaltitle}}}
    \begin{quote}\normalsize
}{
  \vspace{0.6em}\par\end{quote}
}

%%
%% Revision history table and rows
%%
\def\DBKrevtitle{Revision Information}
\def\DBKrevnumber{Version}
\def\DBKrevdesc{Modification}
\def\DBKrevdate{Date}
\def\DBKrevname{Author}

\renewenvironment{DBKrevtable}{
  \textsf{\LARGE{\textbf{\color{is_red}\DBKrevtitle}}}
  \normalsize
  \begin{center}
  \savetablecounter %
  \begin{longtable}{ |>{\centering}p{2cm} |>{\centering}p{2.7cm} |>
  {\raggedright}p{7.9cm} |>{\centering}p{2.5cm} | }

  %% Table Titles
  \hline
  \multicolumn{1}{|c|}{\DBKrevnumber}& \multicolumn{1}{c|}{\DBKrevdate} &
  \multicolumn{1}{c|}{\DBKrevdesc} & \multicolumn{1}{c|}{\DBKrevname}
  \tabularnewline
  \hline
  \endhead
}{
  \end{longtable}
  \restoretablecounter %
  \end{center}
}
\def\DBKdomitete{
  \DBKrevhistory
}

% Custom syntax highlighting
\usepackage{mdframed}

\newenvironment{IsSource}{\ttfamily\small{}}{}

\newenvironment{IsSourceBox}{%
\begin{mdframed}[align=center,userdefinedwidth=.95\textwidth]\begin{IsSource}%
}{\end{IsSource}\end{mdframed}}

\newenvironment{IsSourceInline}{%
\begin{minipage}{\textwidth}\smallskip\begin{IsSource}
}{\end{IsSource}\smallskip\end{minipage}}

% Hack ot support d language used for IOPs
\lstdefinelanguage{d}{}

% txt language is used to force output rendering with source-highlight
\lstdefinelanguage{txt}{}

% Defined some other languages
\lstdefinelanguage{javascript}{}
\lstdefinelanguage{ini}{}


% Set link color */
\hypersetup{linkcolor = is_red}

% Set caption color %
\usepackage{caption}
\captionsetup{font={color=is_red}}
